# Whisper Vault â€“ Sprint âš¡ (July 2025)

> **Goal:** finish the minimal lovable product (MLP) â†’ sign-up â–¶ï¸ confirm-email â–¶ï¸ 2-FA â–¶ï¸ dashboard with real data.

## ğŸ”´ 1 â€“ Un-block API (do this first)
- [ ] **Reset & re-migrate DB**  
      ```bash
      cd server-1
      npx prisma migrate reset --schema=prisma/schema.prisma  # y to confirm
      npx prisma generate
      npm run dev      # API must boot cleanly, no P2022
      ```
- [ ] Commit as `chore(db): reset dev db & regen Prisma client`

## ğŸŸ  2 â€“ Threads / Messages CRUD
- [ ] **threads.ts** â€“ replace mock `findMany` / `create` with real Prisma calls  
      *Return lastMessage + participants; orderBy updatedAt desc.*
- [ ] **messages.ts** â€“ create `POST /api/threads/:id/messages` and `GET` to stream.
- [ ] Add Supertest spec `threads.test.ts` that:  
      1. registers & confirms a user  
      2. creates a thread with two participants  
      3. posts a message and expects `201`

## ğŸŸ  3 â€“ Avatar pipeline
- [ ] **User model** already has `avatarUrl` â†’ create endpoint `PUT /api/me/avatar`  
      *Accept `multipart/form-data`; save file to `/uploads` for now (move to S3 later).*  
- [ ] **NavBar.tsx** â€“ if `avatarUrl` present show `<img>`; else initials.

## ğŸŸ¢ 4 â€“ CI & Docs
- [ ] `.github/workflows/ci.yml`  
      *steps: pnpm install â†’ prisma generate â†’ vitest run â†’ eslint --max-warnings=0*  
- [ ] Update **README** quick-start:  
      `pnpm i && npx prisma migrate reset && pnpm run dev`  

---

### Coding Conventions for Copilot
- All new Express routes end with `export default router;`
- Use ES modules (`import â€¦`) onlyâ€”no `require`.
- Always type Prisma results (`await prisma.user.findFirst<â€¦>()`).
- Front-end hooks live in `/src/hooks/`, components in `/src/components/`.
- Tests must use Vitest + Supertest; wrap DB calls in `beforeEach(async () => prisma.$transaction([...]))`.

*(Leave this file in the repo root; close each task with â€œâœ” doneâ€ when finished.  Copilot will suggest code stubs as you create / open the referenced files.)*
